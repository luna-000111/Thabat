<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IdentitÃ  Stabile â€” Qurâ€™an, Sunnah, luciditÃ </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;900&family=DM+Sans:wght@300;400;500;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#1e1e2e;
      --cream:#f5f7ff;
      --parchment:#eef1ff;
      --mist:#dde3f8;
      --gold:#7c6af7;
      --accent1:#a5b4fc;    /* lavanda */
      --accent2:#86efac;    /* menta */
      --accent3:#fda4af;    /* corallo */
      --green:#4f46e5;
      --red:#e05a6a;
      --shadow: rgba(30,30,46,.07);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'DM Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: linear-gradient(135deg, #f0f4ff 0%, #f8f5ff 50%, #fff0f8 100%);
      min-height:100vh;
      color:var(--ink);
      overflow-x:hidden;
    }
    nav{
      position:sticky; top:0; z-index:10;
      display:flex; justify-content:space-between; align-items:center;
      padding:16px 22px;
      background:rgba(245,247,255,.88); backdrop-filter: blur(14px);
      border-bottom:1px solid rgba(124,106,247,.12);
    }
    .logo{
      font-family:'Playfair Display',serif;
      font-weight:900; letter-spacing:.01em;
      text-decoration:none; color:var(--ink);
    }
    .logo span{color:var(--gold); background:linear-gradient(90deg,#7c6af7,#a78bfa); -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
    .wrap{max-width:1100px;margin:0 auto;padding:28px 18px 80px}
    .hero{
      padding:36px 0 20px;
      display:grid; gap:14px;
    }
    .orn{
      font-family:'Amiri',serif;
      color:var(--gold); letter-spacing:.12em; background:linear-gradient(90deg,#7c6af7,#f472b6); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      font-size:1rem;
    }
    h1{
      font-family:'Playfair Display',serif;
      font-weight:900;
      letter-spacing:-.02em;
      line-height:1.05;
      font-size: clamp(2.1rem, 5vw, 3.6rem);
    }
    .sub{
      color:rgba(26,21,18,.68);
      line-height:1.75;
      max-width:64ch;
      font-size:1.02rem;
    }
    /* -------- FLIP CARDS GRID -------- */
    @keyframes cardFadeIn {
      0%  { opacity:0; transform:translateY(10px); }
      100%{ opacity:1; transform:translateY(0); }
    }
    @keyframes starPop {
      0%  { opacity:0; transform:translate(-50%,-50%) scale(.4) rotate(0deg); }
      15% { opacity:1; }
      100%{ opacity:0; transform:translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1.2) rotate(80deg); }
    }
    .flipStar{
      position:fixed; width:10px; height:10px;
      pointer-events:none; opacity:0;
      transform:translate(-50%,-50%) scale(.4);
      animation: starPop 780ms ease-out forwards;
      z-index:9999;
    }
    .flipStar::before{
      content:"âœ¦"; font-size:15px; line-height:10px; display:block;
      color: var(--sc, #ffcba4);
      text-shadow: 0 0 10px var(--sc, #ffcba4);
    }

    .grid-3{
      margin-top:18px;
      display:grid; gap:18px;
      grid-template-columns: repeat(3, minmax(0,1fr));
    }
    /* seconda riga: 2 carte centrate */
    .grid-3 .flipShell:nth-child(4),
    .grid-3 .flipShell:nth-child(5){
      /* su desktop le ultime 2 occupano la griglia da 3 ma centrate */
    }
    @media(min-width:901px){
      .grid-3{
        grid-template-columns: repeat(6, minmax(0,1fr));
      }
      .grid-3 .flipShell:nth-child(1){ grid-column: span 2; }
      .grid-3 .flipShell:nth-child(2){ grid-column: span 2; }
      .grid-3 .flipShell:nth-child(3){ grid-column: span 2; }
      .grid-3 .flipShell:nth-child(4){ grid-column: 2 / span 2; }
      .grid-3 .flipShell:nth-child(5){ grid-column: 4 / span 2; }
    }
    @media(max-width:900px){ .grid-3{grid-template-columns:1fr} }

    /* Shell della carta */
    .flipShell{
      perspective:1000px;
      min-height:240px;
      cursor:pointer;
      animation: cardFadeIn .7s ease both;
      user-select:none;
    }
    .flipShell:nth-child(1){ animation-delay:.05s }
    .flipShell:nth-child(2){ animation-delay:.15s }
    .flipShell:nth-child(3){ animation-delay:.25s }
    .flipShell:nth-child(4){ animation-delay:.35s }
    .flipShell:nth-child(5){ animation-delay:.45s }

    .flipInner{
      position:relative; width:100%; height:100%;
      min-height:240px;
      transform-style:preserve-3d;
      transition:transform 560ms cubic-bezier(.2,.9,.2,1);
      border-radius:18px;
    }
    .flipShell.flipped .flipInner{ transform:rotateY(180deg); }

    /* Colori per carta: variabili CSS per-carta */
    #fc0 { --cc: #ddd6fe; --cc2: #a78bfa; }   /* lavanda pastello */
    #fc1 { --cc: #bbf7d0; --cc2: #4ade80; }   /* menta fresca */
    #fc2 { --cc: #fecdd3; --cc2: #fb7185; }   /* corallo/pesca */
    #fc3 { --cc: #fef9c3; --cc2: #facc15; }   /* giallo miele â€” Äya */
    #fc4 { --cc: #cffafe; --cc2: #22d3ee; }   /* ciano â€” lo sapevi */

    .flipFace{
      position:absolute; inset:0;
      border-radius:18px;
      backface-visibility:hidden;
      -webkit-backface-visibility:hidden;
      overflow:hidden;
      display:flex; flex-direction:column;
      justify-content:center; align-items:center;
      text-align:center;
      padding:20px 18px;
      box-shadow: 0 14px 40px rgba(26,21,18,.10);
    }

    /* FRONTE â€” sfondo colorato con gradiente */
    .flipFace.flipFront{
      background: linear-gradient(145deg, var(--cc) 0%, color-mix(in srgb, var(--cc) 60%, white) 100%);
      border: 2px solid var(--cc2);
      transform:rotateY(0deg) translateZ(1px);
    }
    .flipFace.flipFront::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(ellipse at 70% 10%, rgba(255,255,255,.45), transparent 60%);
      pointer-events:none;
    }

    /* RETRO â€” bianco con solo la cornice colorata */
    .flipFace.flipBack{
      background: #ffffff;
      border: 2.5px solid var(--cc2);
      transform:rotateY(180deg) translateZ(1px);
    }
    .flipFace.flipBack::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(ellipse at 50% 0%, color-mix(in srgb, var(--cc) 30%, transparent), transparent 55%);
      pointer-events:none;
    }

    /* label tag â€” tinto con il colore della carta */
    .fTag{
      position:absolute; top:12px; right:14px;
      font-size:.72rem; font-weight:700;
      color: #1a1512;
      background: color-mix(in srgb, var(--cc) 45%, white);
      border:1px solid var(--cc2);
      padding:4px 9px; border-radius:999px;
    }

    /* flip hint */
    .fHint{
      position:absolute; bottom:11px; left:0; right:0;
      text-align:center;
      font-size:.72rem; color:rgba(26,21,18,.38); letter-spacing:.04em;
    }

    /* Contenuto fronte */
    .fFrontContent{ position:relative; z-index:1; }
    .fLabel{
      font-size:.7rem; letter-spacing:.13em; text-transform:uppercase;
      color: #1a1512; font-weight:700; margin-bottom:8px; opacity:.75;
    }
    .fArabic{
      font-family:'Amiri',serif;
      font-size:1.6rem; line-height:1.8;
      color: #1a1512; direction:rtl;
      margin-bottom:6px;
    }
    .fTitle{
      font-family:'Playfair Display',serif;
      font-size:1.1rem; font-weight:800; color:var(--ink);
      margin-bottom:4px;
    }
    .fSub{
      font-size:.85rem; color:rgba(26,21,18,.65); line-height:1.5;
    }

    /* Contenuto retro */
    .fBackContent{ position:relative; z-index:1; }
    .fBackTitle{
      font-family:'Playfair Display',serif;
      font-size:.92rem; font-weight:900;
      color: #1a1512; margin-bottom:8px;
    }
    .fBackBody{
      font-size:.88rem; color:rgba(26,21,18,.80); line-height:1.65;
    }
    .fBackRef{
      margin-top:10px;
      font-size:.75rem; color:rgba(26,21,18,.48); letter-spacing:.02em;
    }

    .fBackDivider{
      height:1px; background:rgba(26,21,18,.10);
      margin:10px 0;
    }
    .tag{
      font-size:.78rem; color:var(--green);
      background:rgba(45,74,62,.08);
      border:1px solid rgba(45,74,62,.12);
      padding:5px 10px; border-radius:999px; white-space:nowrap;
    }
    .arabic{
      font-family:'Amiri',serif; font-size:1.25rem; line-height:1.8;
      text-align:right; color:var(--green); margin-top:6px;
    }
    .ref{
      margin-top:8px; font-size:.82rem;
      color:rgba(26,21,18,.55); letter-spacing:.02em;
    }

    hr.sep{
      border:none; border-top:1px solid rgba(200,169,110,.18);
      margin:26px 0;
    }

    .panel{
      background:#fff;
      border:1px solid rgba(124,106,247,.14);
      border-radius:20px;
      padding:18px;
      box-shadow: 0 8px 32px rgba(124,106,247,.07);
    }
    .panelHead{
      display:grid; gap:8px;
      padding:6px 6px 10px;
    }
    .kicker{
      font-size:.78rem;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--gold);
      font-weight:700;
    }
    .panelTitle{
      font-family:'Playfair Display',serif;
      font-weight:900;
      font-size:1.45rem;
      line-height:1.2;
    }
    .panelDesc{
      color:rgba(26,21,18,.65);
      line-height:1.7;
      max-width:70ch;
    }

    .rows{
      margin-top:12px;
      display:grid;
      gap:12px;
    }
    .rowTitle{
      font-weight:800; font-size:1rem;
      color:rgba(26,21,18,.85);
      margin:6px 0 6px;
    }
    .need-row{
      display:flex; flex-wrap:wrap; gap:10px;
    }
    .btn{
      cursor:pointer;
      background:#fff;
      border:1.5px solid var(--mist);
      border-radius:12px;
      padding:12px 14px;
      min-width: 220px;
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
      transition: transform .14s ease, border-color .14s ease, background .14s ease, box-shadow .14s ease;
      box-shadow: 0 4px 14px rgba(124,106,247,.06);
      text-align:left;
    }
    .btn:hover{transform: translateY(-2px); border-color: rgba(124,106,247,.35); box-shadow: 0 8px 24px rgba(124,106,247,.12);}
    .btn.active{
      background: linear-gradient(135deg,#7c6af7,#a78bfa);
      border-color:transparent;
      color:#fff;
      box-shadow: 0 8px 24px rgba(124,106,247,.25);
    }
    .btn small{display:block; opacity:.65; margin-top:2px; font-weight:500}

    .out{
      margin-top:14px;
      background:#fff;
      border:1px solid rgba(124,106,247,.14);
      border-radius:18px;
      padding:18px;
      box-shadow: 0 12px 40px rgba(124,106,247,.08);
    }
    .outTop{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      padding-bottom:12px;
      border-bottom:1px solid rgba(124,106,247,.12);
      margin-bottom:12px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      background:rgba(124,106,247,.08);
      border:1px solid rgba(124,106,247,.18);
      color:var(--ink);
      border-radius:999px;
      padding:7px 12px;
      font-size:.82rem;
      letter-spacing:.02em;
    }
    .outTitle{
      font-family:'Playfair Display',serif;
      font-weight:900;
      font-size:1.5rem;
      line-height:1.2;
    }
    .cols{
      display:grid; gap:12px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media(max-width:900px){ .cols{grid-template-columns:1fr;} }
    .block{
      background:#f8f7ff;
      border:1px solid rgba(124,106,247,.12);
      border-radius:12px;
      padding:14px;
    }
    .block h3{
      font-family:'Playfair Display',serif;
      font-weight:800;
      font-size:1.05rem;
      margin-bottom:8px;
    }
    .block p{line-height:1.75; color:rgba(26,21,18,.78); font-size:.95rem;}
    .muted{color:rgba(26,21,18,.62)}
    .list{
      margin-top:10px;
      display:grid; gap:8px;
    }
    .item{
      display:flex; gap:10px; align-items:flex-start;
      line-height:1.6;
      color:rgba(26,21,18,.78);
      font-size:.95rem;
    }
    .dot{
      width:18px; height:18px; border-radius:6px;
      background:rgba(45,74,62,.10);
      border:1px solid rgba(45,74,62,.14);
      display:flex; align-items:center; justify-content:center;
      color:var(--green);
      font-weight:900;
      flex:0 0 auto;
      margin-top:2px;
      font-size:.78rem;
    }
    .danger{color:var(--red); font-weight:800}
    .footnote{
      margin-top:12px;
      font-size:.85rem;
      color:rgba(26,21,18,.55);
      line-height:1.7;
    }
    .letter{
      margin-top:12px;
      padding:14px;
      border-radius:12px;
      border:1px solid rgba(124,106,247,.18);
      background: rgba(124,106,247,.04);
    }
    .letter h3{font-family:'Playfair Display',serif;font-weight:900;margin-bottom:8px}
    .sig{
      margin-top:10px;
      color:rgba(26,21,18,.62);
      font-weight:700;
      letter-spacing:.02em;
    }
    footer{
      margin-top:32px;
      padding:22px 0 0;
      color:rgba(30,30,46,.50);
      font-size:.86rem;
      line-height:1.7;
      border-top:1px solid rgba(124,106,247,.14);
    }
    .smallBtns{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:8px;
    }
    .linkBtn{
      cursor:pointer;
      background: rgba(124,106,247,.10);
      border:1px solid rgba(124,106,247,.22);
      color:var(--ink);
      padding:9px 14px;
      border-radius:10px;
      font-weight:700;
      letter-spacing:.01em;
      font-size:.88rem;
      transition: background .14s, border-color .14s, transform .14s;
    }
    .linkBtn:hover{background:rgba(124,106,247,.18); border-color:rgba(124,106,247,.4); transform:translateY(-1px);}
  </style>
</head>

<body>
  <nav>
    <a class="logo" href="#"><span>IdentitÃ </span> Stabile</a>
    <div style="opacity:.7;font-size:.9rem">Qurâ€™an Â· Sunnah Â· luciditÃ  Â· protezione</div>
  </nav>

  <div class="wrap">

    <section class="hero">
      <div class="orn">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…</div>
      <h1>Chi sei quando nessuno ti guarda?</h1>
      <p class="sub">
        Un percorso semplice, guidato dal tuo <strong>stato emotivo</strong>. Capisci <strong>identitÃ </strong>, <strong>bias</strong>, <strong>influenze</strong>,
        riconosci <strong>manipolazioni</strong>, e nei momenti di debolezza ricevi un messaggio che ti riporta alla luciditÃ  â€” con Qurâ€™an e Sunnah.
      </p>

      <div class="grid-3" id="dailyRow">
        <!-- filled by JS -->
      </div>

      <div class="smallBtns">
        <button class="linkBtn" onclick="scrollToTool()">Vai allo strumento â€œCome ti senti?â€</button>
        <button class="linkBtn" onclick="openQuickTest()">Apri Test (breve)</button>
      </div>
    </section>

    <hr class="sep" />

    <section class="panel" id="tool">
      <div class="panelHead">
        <div class="kicker">STRUMENTO DEL MOMENTO</div>
        <div class="panelTitle">Come ti senti oggi?</div>
        <div class="panelDesc">
          Scegli lo stato emotivo e ciÃ² di cui hai bisogno adesso. In modalitÃ  <strong>ğŸŒ¿ Centrale</strong> riceverai anche una
          <strong>lettera a te stesso</strong> (con hadith breve del Profeta ï·º da ripetere oggi).
          Le altre modalitÃ  sono lenti: <em>Difesa</em>, <em>Shayá¹­Än</em>, <em>Cuore</em>, <em>Bias</em>.
        </div>
      </div>

      <div class="rows">
        <div>
          <div class="rowTitle">1) Stato</div>
          <div class="need-row" id="moods"></div>
        </div>

        <div>
          <div class="rowTitle">2) Bisogno</div>
          <div class="need-row" id="needs"></div>
        </div>

        <div>
          <div class="rowTitle">ModalitÃ </div>
          <div class="need-row" id="modes"></div>
          <div class="footnote">Suggerimento: ogni scelta torna automaticamente su <strong>ğŸŒ¿ Centrale</strong> per non restare â€œintrappolatoâ€ in una lente.</div>
        </div>

        <div class="out" id="output" style="display:none;"></div>
      </div>
    </section>

    <footer>
      <strong>Nota:</strong> contenuti educativi. Non sostituiscono terapia o consulenza religiosa qualificata.
      Se stai attraversando crisi intensa o pensieri pericolosi, parla con una persona competente e cerca aiuto immediato.
    </footer>

  </div>

<script>
/* =========================
   UTIL
========================= */
function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function scrollToTool(){ document.getElementById("tool").scrollIntoView({behavior:"smooth"}); }

/* =========================
   DAILY (Nome di Allah / Profeta ï·º / Duâ€˜Ä)
   (seme deterministico basato sulla data locale)
========================= */
function dateSeed(){
  const d = new Date();
  const key = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
  // semplice hash deterministico
  let h=0;
  for(let i=0;i<key.length;i++) h = (h*31 + key.charCodeAt(i)) >>> 0;
  return h;
}
function pickDaily(arr){
  const h = dateSeed();
  return arr[h % arr.length];
}

const DAILY_ALLAH = [
  { name:"Ù±Ù„Ù’Ù‡ÙØ§Ø¯ÙÙŠ", it:"Al-HÄdÄ« â€” Il Guida", note:"Quando sei confuso: chiedi guida e fai un passo retto." },
  { name:"Ù±Ù„Ù’Ø­ÙÙƒÙÙŠÙ…", it:"Al-á¸¤akÄ«m â€” Il Sapiente", note:"Quando non capisci il perchÃ©: la saggezza di Allah supera la tua vista." },
  { name:"Ù±Ù„Ù’ÙˆÙÙƒÙÙŠÙ„", it:"Al-WakÄ«l â€” Il Custode", note:"Quando temi il risultato: affida e agisci." },
  { name:"Ù±Ù„Ù’ØºÙÙÙÙˆØ±", it:"Al-GhafÅ«r â€” Il Perdonatore", note:"Quando sbagli: ritorna senza disperare." },
  { name:"Ù±Ù„Ù’Ù„ÙÙ‘Ø·ÙÙŠÙ", it:"Al-Laá¹­Ä«f â€” Il Sottile, Delicato", note:"Quando ti senti fragile: Allah vede ciÃ² che Ã¨ invisibile." },
];

const DAILY_PROPHET = [
  { trait:"Raá¸¥ma (misericordia)", it:"Il Profeta ï·º era misericordioso e gentile.", ref:"Qurâ€™an 21:107 (misericordia per i mondi)" },
  { trait:"á¸¤ilm (forbearance)", it:"Pazienza e controllo quando provocato.", ref:"Sunnah: autocontrollo e adab" },
  { trait:"á¹¢idq (veritÃ )", it:"SinceritÃ  e coerenza: la lingua segue il cuore.", ref:"Valore: veritÃ  sopra approvazione" },
  { trait:"â€˜Adl (giustizia)", it:"Giustizia con adab: confini senza oppressione.", ref:"Etica profetica" },
  { trait:"TawÄá¸uâ€˜ (umiltÃ )", it:"UmiltÃ  reale: non difendere lâ€™ego, difendere la veritÃ .", ref:"Etica profetica" },
];

const DAILY_DUA = [
  { ar:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ù‡Ù’Ø¯ÙÙ†ÙÙŠ ÙˆÙØ³ÙØ¯ÙÙ‘Ø¯Ù’Ù†ÙÙŠ", it:"O Allah, guidami e rendimi saldo.", ref:"Duâ€˜Ä profetica" },
  { ar:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù Ø§Ù„Ù’Ù‡ÙÙ…ÙÙ‘ ÙˆÙØ§Ù„Ù’Ø­ÙØ²ÙÙ†Ù", it:"O Allah, cerco rifugio in Te dallâ€™angoscia e dalla tristezza.", ref:"Duâ€˜Ä profetica" },
  { ar:"Ø­ÙØ³Ù’Ø¨ÙÙŠÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ", it:"Allah mi basta. Non câ€™Ã¨ divinitÃ  se non Lui.", ref:"Dhikr profetico" },
  { ar:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù…ÙÙ‚ÙÙ„ÙÙ‘Ø¨Ù Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù Ø«ÙØ¨ÙÙ‘ØªÙ’ Ù‚ÙÙ„Ù’Ø¨ÙÙŠ Ø¹ÙÙ„ÙÙ‰ Ø¯ÙÙŠÙ†ÙÙƒÙ", it:"O Volgitore dei cuori, rendi saldo il mio cuore sulla Tua religione.", ref:"Tirmidhi" },
  { ar:"Ø±ÙØ¨ÙÙ‘ Ø§Ø´Ù’Ø±ÙØ­Ù’ Ù„ÙÙŠ ØµÙØ¯Ù’Ø±ÙÙŠ", it:"Signore, aprimi il petto.", ref:"Qurâ€™an 20:25" },
];


/* ===== Ä€YA DEL GIORNO ===================================================
   Ogni voce: ar, it, ref, tema (corrisponde alle chiavi di MOOD_BASE)    */
const QURAN_AYA = [
  // generale
  { ar:"Ø¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§", it:"Davvero, dopo la difficoltÃ  viene la facilitÃ .", ref:"Qur'an 94:6", tema:null },
  { ar:"ÙˆÙÙ„ÙØ§ ØªÙÙŠÙ’Ø£ÙØ³ÙÙˆØ§ Ù…ÙÙ† Ø±ÙÙ‘ÙˆÙ’Ø­Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", it:"Non disperate della misericordia di Allah.", ref:"Qur'an 12:87", tema:null },
  { ar:"Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙØ¹Ù Ø§Ù„ØµÙÙ‘Ø§Ø¨ÙØ±ÙÙŠÙ†Ù", it:"Allah Ã¨ con i pazienti.", ref:"Qur'an 2:153", tema:null },
  { ar:"ÙˆÙÙ‡ÙÙˆÙ Ù…ÙØ¹ÙÙƒÙÙ…Ù’ Ø£ÙÙŠÙ’Ù†Ù Ù…ÙØ§ ÙƒÙÙ†ØªÙÙ…Ù’", it:"Egli Ã¨ con voi dovunque siate.", ref:"Qur'an 57:4", tema:null },
  { ar:"ÙÙØ¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§", it:"Dopo la difficoltÃ  viene la facilitÃ .", ref:"Qur'an 94:5", tema:null },
  { ar:"ÙˆÙØ§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØ­ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ù…ÙØ­Ù’Ø³ÙÙ†ÙÙŠÙ†Ù", it:"Allah ama coloro che fanno il bene.", ref:"Qur'an 3:134", tema:null },
  { ar:"Ø£ÙÙ„ÙØ§ Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù", it:"Nel ricordo di Allah i cuori trovano pace.", ref:"Qur'an 13:28", tema:null },
  { ar:"ÙˆÙÙ…ÙÙ† ÙŠÙØªÙÙ‘Ù‚Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØ¬Ù’Ø¹ÙÙ„ Ù„ÙÙ‘Ù‡Ù Ù…ÙØ®Ù’Ø±ÙØ¬Ù‹Ø§", it:"Chi teme Allah, Egli gli aprirÃ  una via d'uscita.", ref:"Qur'an 65:2", tema:null },
  // tristezza
  { ar:"Ù„ÙØ§ ØªÙØ­Ù’Ø²ÙÙ†Ù’ Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙØ¹ÙÙ†ÙØ§", it:"Non rattristarti: Allah Ã¨ con noi.", ref:"Qur'an 9:40", tema:"sad" },
  { ar:"Ù„ÙØ§ ØªÙÙ‚Ù’Ù†ÙØ·ÙÙˆØ§ Ù…ÙÙ† Ø±ÙÙ‘Ø­Ù’Ù…ÙØ©Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", it:"Non disperate della misericordia di Allah.", ref:"Qur'an 39:53", tema:"sad" },
  // ansia
  { ar:"ÙˆÙÙ…ÙÙ† ÙŠÙØªÙÙˆÙÙƒÙÙ‘Ù„Ù’ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙÙÙ‡ÙÙˆÙ Ø­ÙØ³Ù’Ø¨ÙÙ‡Ù", it:"Chi si affida ad Allah, Egli gli Ã¨ sufficiente.", ref:"Qur'an 65:3", tema:"anxious" },
  { ar:"Ø­ÙØ³Ù’Ø¨ÙÙ†ÙØ§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙ†ÙØ¹Ù’Ù…Ù Ø§Ù„Ù’ÙˆÙÙƒÙÙŠÙ„Ù", it:"Allah ci basta: Ã¨ il migliore dei tutori.", ref:"Qur'an 3:173", tema:"anxious" },
  // rabbia
  { ar:"ÙˆÙØ§Ù„Ù’ÙƒÙØ§Ø¸ÙÙ…ÙÙŠÙ†Ù Ø§Ù„Ù’ØºÙÙŠÙ’Ø¸Ù ÙˆÙØ§Ù„Ù’Ø¹ÙØ§ÙÙÙŠÙ†Ù Ø¹ÙÙ†Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù", it:"Coloro che trattengono la rabbia e perdonano gli altri.", ref:"Qur'an 3:134", tema:"angry" },
  // colpa/pentimento
  { ar:"Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØºÙ’ÙÙØ±Ù Ø§Ù„Ø°ÙÙ‘Ù†ÙÙˆØ¨Ù Ø¬ÙÙ…ÙÙŠØ¹Ù‹Ø§", it:"Allah perdona tutti i peccati.", ref:"Qur'an 39:53", tema:"guilty" },
  { ar:"ÙˆÙØªÙÙˆØ¨ÙÙˆØ§ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¬ÙÙ…ÙÙŠØ¹Ù‹Ø§", it:"Tornate tutti ad Allah.", ref:"Qur'an 24:31", tema:"guilty" },
  // vuoto
  { ar:"ÙÙØ£ÙÙŠÙ’Ù†ÙÙ…ÙØ§ ØªÙÙˆÙÙ„ÙÙ‘ÙˆØ§ ÙÙØ«ÙÙ…ÙÙ‘ ÙˆÙØ¬Ù’Ù‡Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", it:"Ovunque vi voltiate, lÃ  c'Ã¨ il Volto di Allah.", ref:"Qur'an 2:115", tema:"empty" },
  // confusione
  { ar:"ÙˆÙØ§ØªÙÙ‘Ù‚ÙÙˆØ§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙŠÙØ¹ÙÙ„ÙÙ‘Ù…ÙÙƒÙÙ…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", it:"Abbiate taqwa e Allah vi insegnerÃ .", ref:"Qur'an 2:282", tema:"confused" },
  // ferita
  { ar:"Ø¥ÙÙ†ÙÙ‘ Ø£ÙÙƒÙ’Ø±ÙÙ…ÙÙƒÙÙ…Ù’ Ø¹ÙÙ†Ø¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØªÙ’Ù‚ÙØ§ÙƒÙÙ…Ù’", it:"Il piÃ¹ nobile presso Allah Ã¨ il piÃ¹ pio.", ref:"Qur'an 49:13", tema:"hurt" },
  // tentazione
  { ar:"ÙˆÙØ£ÙÙ…ÙÙ‘Ø§ Ù…ÙÙ†Ù’ Ø®ÙØ§ÙÙ Ù…ÙÙ‚ÙØ§Ù…Ù Ø±ÙØ¨ÙÙ‘Ù‡Ù ÙˆÙÙ†ÙÙ‡ÙÙ‰ Ø§Ù„Ù†ÙÙ‘ÙÙ’Ø³Ù Ø¹ÙÙ†Ù Ø§Ù„Ù’Ù‡ÙÙˆÙÙ‰Ù°", it:"Chi teme il suo Signore e frena il desiderioâ€¦", ref:"Qur'an 79:40", tema:"tempted" },
];

/* ===== FATTI SCIENTIFICI DEL CORANO ===================================== */
const SCIENCE_FACTS = [
  {
    domanda:"L'espansione dell'universo",
    fatto:"Il Corano descrive il cielo come qualcosa che Allah ha Â«costruito con potenzaÂ» e che Â«espande continuamenteÂ» (Ù…ÙÙˆØ³ÙØ¹ÙÙˆÙ†Ù). La scoperta scientifica dell'espansione dell'universo risale al 1929 con Edwin Hubble.",
    ref:"Qur'an 51:47",
    ar:"ÙˆÙØ§Ù„Ø³ÙÙ‘Ù…ÙØ§Ø¡Ù Ø¨ÙÙ†ÙÙŠÙ’Ù†ÙØ§Ù‡ÙØ§ Ø¨ÙØ£ÙÙŠÙ’Ø¯Ù ÙˆÙØ¥ÙÙ†ÙÙ‘Ø§ Ù„ÙÙ…ÙÙˆØ³ÙØ¹ÙÙˆÙ†Ù",
    nota:"Il termine arabo mÅ«siÊ¿Å«n ("espandiamo") Ã¨ al presente continuo."
  },
  {
    domanda:"Le acque che non si mischiano",
    fatto:"Il Corano parla di due mari che si incontrano ma non si mescolano, separati da una Â«barrieraÂ». La moderna oceanografia ha confermato che masse d'acqua con diverse densitÃ , salinitÃ  e temperature mantengono zone di mescolamento limitato.",
    ref:"Qur'an 55:19-20",
    ar:"Ù…ÙØ±ÙØ¬Ù Ø§Ù„Ù’Ø¨ÙØ­Ù’Ø±ÙÙŠÙ’Ù†Ù ÙŠÙÙ„Ù’ØªÙÙ‚ÙÙŠÙØ§Ù†Ù â€” Ø¨ÙÙŠÙ’Ù†ÙÙ‡ÙÙ…ÙØ§ Ø¨ÙØ±Ù’Ø²ÙØ®ÙŒ Ù„ÙÙ‘Ø§ ÙŠÙØ¨Ù’ØºÙÙŠÙØ§Ù†Ù",
    nota:"Studiato in dettaglio da Jacques Cousteau nel Mediterraneo/Atlantico."
  },
  {
    domanda:"Le tenebre negli abissi marini",
    fatto:"Il Corano descrive oscuritÃ  stratificate nelle profonditÃ  del mare, con onde sopra e nubi sopra ancora. I sonar moderni confermano che a oltre 200 m di profonditÃ  non penetra luce solare.",
    ref:"Qur'an 24:40",
    ar:"Ø£ÙÙˆÙ’ ÙƒÙØ¸ÙÙ„ÙÙ…ÙØ§ØªÙ ÙÙÙŠ Ø¨ÙØ­Ù’Ø±Ù Ù„ÙÙ‘Ø¬ÙÙ‘ÙŠÙÙ‘ ÙŠÙØºÙ’Ø´ÙØ§Ù‡Ù Ù…ÙÙˆÙ’Ø¬ÙŒ",
    nota:"L'occhio umano non puÃ² percepire queste profonditÃ  senza strumenti."
  },
  {
    domanda:"Le impronte digitali",
    fatto:"Il Corano afferma che Allah Ã¨ capace di ricreare persino le Â«polpastrelliÂ» (Ø¨ÙÙ†ÙØ§Ù†ÙÙ‡Ù) dell'uomo. Le impronte digitali come identificatore unico di ogni persona furono scoperte dalla scienza solo nel 1880.",
    ref:"Qur'an 75:3-4",
    ar:"Ø£ÙÙŠÙØ­Ù’Ø³ÙØ¨Ù Ø§Ù„Ù’Ø¥ÙÙ†Ø³ÙØ§Ù†Ù Ø£ÙÙ„ÙÙ‘Ù† Ù†ÙÙ‘Ø¬Ù’Ù…ÙØ¹Ù Ø¹ÙØ¸ÙØ§Ù…ÙÙ‡Ù â€” Ø¨ÙÙ„ÙÙ‰Ù° Ù‚ÙØ§Ø¯ÙØ±ÙÙŠÙ†Ù Ø¹ÙÙ„ÙÙ‰Ù° Ø£ÙÙ† Ù†ÙÙ‘Ø³ÙÙˆÙÙ‘ÙŠÙ Ø¨ÙÙ†ÙØ§Ù†ÙÙ‡Ù",
    nota:"Francis Galton classificÃ² le impronte nel 1892."
  },
  {
    domanda:"Lo sviluppo embrionale",
    fatto:"Il Corano descrive le fasi dell'embrione: nutfa (goccia), alaqa (attaccato/sanguisuga), mudgha (massa masticata). L'embriologia moderna descrive fasi simili: zigote, impianto, somiti che assomigliano a un pezzo masticato.",
    ref:"Qur'an 23:13-14",
    ar:"Ø«ÙÙ…ÙÙ‘ Ø¬ÙØ¹ÙÙ„Ù’Ù†ÙØ§Ù‡Ù Ù†ÙØ·Ù’ÙÙØ©Ù‹ ÙÙÙŠ Ù‚ÙØ±ÙØ§Ø±Ù Ù…ÙÙ‘ÙƒÙÙŠÙ†Ù â€” Ø«ÙÙ…ÙÙ‘ Ø®ÙÙ„ÙÙ‚Ù’Ù†ÙØ§ Ø§Ù„Ù†ÙÙ‘Ø·Ù’ÙÙØ©Ù Ø¹ÙÙ„ÙÙ‚ÙØ©Ù‹",
    nota:"Il Prof. Keith Moore (anatomista) ha studiato queste descrizioni."
  },
  {
    domanda:"Il ferro non Ã¨ terrestre",
    fatto:"Il Corano dice che il ferro fu Â«inviato dall'altoÂ» (Ø£ÙÙ†Ø²ÙÙ„Ù’Ù†ÙØ§). Gli scienziati confermano che il ferro sulla Terra proviene da stelle esplose (supernovae): la Terra non aveva energia sufficiente per produrlo.",
    ref:"Qur'an 57:25",
    ar:"ÙˆÙØ£ÙÙ†Ø²ÙÙ„Ù’Ù†ÙØ§ Ø§Ù„Ù’Ø­ÙØ¯ÙÙŠØ¯Ù ÙÙÙŠÙ‡Ù Ø¨ÙØ£Ù’Ø³ÙŒ Ø´ÙØ¯ÙÙŠØ¯ÙŒ",
    nota:"Il numero atomico del ferro (26) compare in modo intrigante nel versetto 57:25."
  },
  {
    domanda:"Le montagne come picchetti",
    fatto:"Il Corano descrive le montagne come Â«picchettiÂ» (Ø£ÙÙˆÙ’ØªÙØ§Ø¯Ù‹Ø§). La geologia moderna ha scoperto che le montagne hanno Â«radiciÂ» profonde sotto la crosta terrestre, proprio come i picchetti, che stabilizzano la litosfera.",
    ref:"Qur'an 78:6-7",
    ar:"Ø£ÙÙ„ÙÙ…Ù’ Ù†ÙØ¬Ù’Ø¹ÙÙ„Ù Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù Ù…ÙÙ‡ÙØ§Ø¯Ù‹Ø§ â€” ÙˆÙØ§Ù„Ù’Ø¬ÙØ¨ÙØ§Ù„Ù Ø£ÙÙˆÙ’ØªÙØ§Ø¯Ù‹Ø§",
    nota:"Le radici delle montagne possono essere 3-4 volte piÃ¹ profonde della parte visibile."
  },
  {
    domanda:"Il ciclo dell'acqua",
    fatto:"Il Corano descrive l'evaporazione dai mari, la formazione delle nuvole, la pioggia e i fiumi che tornano al mare. Questo ciclo idrologico completo fu descritto scientificamente solo nel XVI-XVII secolo da Palissy e Mariotte.",
    ref:"Qur'an 39:21",
    ar:"Ø£ÙÙ„ÙÙ…Ù’ ØªÙØ±Ù Ø£ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙ†Ø²ÙÙ„Ù Ù…ÙÙ†Ù Ø§Ù„Ø³ÙÙ‘Ù…ÙØ§Ø¡Ù Ù…ÙØ§Ø¡Ù‹",
    nota:"Il Corano descrive il ciclo completo in piÃ¹ di 30 versetti."
  },
];

/* mazzo shufflato per ogni carta â€” nessuna ripetizione fino a fine mazzo */
function makeDeck(n){ const a=[...Array(n).keys()]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; }
const fcDecks = {
  fc0: { deck: makeDeck(DAILY_ALLAH.length),   pos: 0 },
  fc1: { deck: makeDeck(DAILY_PROPHET.length), pos: 0 },
  fc2: { deck: makeDeck(DAILY_DUA.length),     pos: 0 },
  fc3: { deck: null, pos: 0 },   /* deck dinamico: dipende da emozione o generale */
  fc4: { deck: makeDeck(SCIENCE_FACTS.length), pos: 0 },
};
function peekCard(id){
  const d = fcDecks[id];
  return d.deck ? d.deck[d.pos] : 0;
}
function advanceCard(id){
  const d = fcDecks[id];
  if(!d.deck) return;
  d.pos++;
  if(d.pos >= d.deck.length){ d.deck = makeDeck(d.deck.length); d.pos = 0; }
}
function rebuildAyaDeck(moodKey){
  const pool = moodKey
    ? QURAN_AYA.filter(a => a.tema === moodKey || a.tema === null)
    : QURAN_AYA;
  const effective = pool.length > 0 ? pool : QURAN_AYA;
  /* mappa indici del pool originale */
  const indices = effective.map((_,i)=>i);
  const shuffled = [...indices];
  for(let i=shuffled.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]];}
  fcDecks.fc3 = { deck: shuffled, pos: 0, pool: effective };
}
/* inizializza fc3 senza emozione */
rebuildAyaDeck(null);

/* stelle complementari per ogni carta */
const STAR_COLORS_FC0 = ["#fde68a","#fcd34d","#fef3c7","#fbbf24","#fef08a","#fde047"]; /* giallo â€” compl. lavanda */
const STAR_COLORS_FC1 = ["#fda4af","#fb7185","#fecdd3","#f9a8d4","#fbcfe8","#fda4af"]; /* rosa â€” compl. menta */
const STAR_COLORS_FC2 = ["#a5f3fc","#67e8f9","#cffafe","#7dd3fc","#bae6fd","#a5f3fc"]; /* turchese â€” compl. corallo */
const STAR_COLORS_FC3 = ["#c4b5fd","#a78bfa","#ddd6fe","#8b5cf6","#ede9fe","#7c3aed"]; /* viola â€” compl. giallo */
const STAR_COLORS_FC4 = ["#fda4af","#fb7185","#fecdd3","#f472b6","#fbcfe8","#ec4899"]; /* rosa â€” compl. ciano */

function spawnFlipStars(cx, cy, colors){
  for(let i=0;i<14;i++){
    const el = document.createElement("div");
    el.className = "flipStar";
    const angle = Math.random()*Math.PI*2;
    const dist  = 30 + Math.random()*52;
    el.style.setProperty("--dx", (Math.cos(angle)*dist)+"px");
    el.style.setProperty("--dy", (Math.sin(angle)*dist)+"px");
    el.style.setProperty("--sc", colors[i % colors.length]);
    el.style.left = cx+"px";
    el.style.top  = cy+"px";
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 840);
  }
}

function updateBackContent(id){
  const back = document.querySelector("#"+id+" .flipBack .fBackContent");
  if(!back) return;

  if(id === "fc0"){
    const item = DAILY_ALLAH[peekCard("fc0")];
    back.innerHTML =
      '<div class="fArabic" style="font-size:2rem;margin-bottom:6px">'+escapeHtml(item.name)+'</div>'+
      '<div class="fBackTitle">'+escapeHtml(item.it)+'</div>'+
      '<div class="fBackBody">'+escapeHtml(item.note)+'</div>';

  } else if(id === "fc1"){
    const item = DAILY_PROPHET[peekCard("fc1")];
    back.innerHTML =
      '<div class="fBackTitle">'+escapeHtml(item.trait)+'</div>'+
      '<div class="fBackBody" style="margin-bottom:8px">'+escapeHtml(item.it)+'</div>'+
      '<div style="font-family:Amiri,serif;font-size:1.1rem;direction:rtl;text-align:right;color:#1a1512;line-height:1.8;margin:6px 0">'+escapeHtml(item.hadith_ar)+'</div>'+
      '<div class="fBackBody" style="font-style:italic;margin-bottom:2px">'+escapeHtml(item.hadith_it)+'</div>'+
      '<div class="fBackRef">'+escapeHtml(item.hadith_ref)+'</div>'+
      '<div class="fBackDivider"></div>'+
      '<div class="fBackBody" style="font-size:.82rem"><strong>Sunnah pratica:</strong> '+escapeHtml(item.sunnah)+'</div>';

  } else if(id === "fc2"){
    const item = DAILY_DUA[peekCard("fc2")];
    back.innerHTML =
      '<div class="fArabic" style="font-size:1.2rem;margin-bottom:10px">'+escapeHtml(item.ar)+'</div>'+
      '<div class="fBackBody"><strong>'+escapeHtml(item.it)+'</strong></div>'+
      '<div class="fBackRef">'+escapeHtml(item.ref)+'</div>';

  } else if(id === "fc3"){
    const d = fcDecks.fc3;
    const item = d.pool[d.deck[d.pos] % d.pool.length];
    back.innerHTML =
      '<div class="fArabic" style="font-size:1.15rem;margin-bottom:8px">'+escapeHtml(item.ar)+'</div>'+
      '<div class="fBackBody" style="margin-bottom:4px"><strong>'+escapeHtml(item.it)+'</strong></div>'+
      '<div class="fBackRef">'+escapeHtml(item.ref)+'</div>';

  } else if(id === "fc4"){
    const item = SCIENCE_FACTS[peekCard("fc4")];
    back.innerHTML =
      '<div class="fBackTitle" style="margin-bottom:6px">'+escapeHtml(item.domanda)+'</div>'+
      '<div class="fArabic" style="font-size:1rem;margin-bottom:6px;opacity:.8">'+escapeHtml(item.ar)+'</div>'+
      '<div class="fBackRef" style="margin-bottom:6px">'+escapeHtml(item.ref)+'</div>'+
      '<div class="fBackDivider"></div>'+
      '<div class="fBackBody" style="font-size:.82rem">'+escapeHtml(item.fatto)+'</div>'+
      '<div class="fBackRef" style="margin-top:6px;font-style:italic">'+escapeHtml(item.nota)+'</div>';
  }
}

const STAR_MAP = { fc0:STAR_COLORS_FC0, fc1:STAR_COLORS_FC1, fc2:STAR_COLORS_FC2, fc3:STAR_COLORS_FC3, fc4:STAR_COLORS_FC4 };

function toggleFlip(id, ev){
  const shell = document.getElementById(id);
  if(!shell) return;
  const rect = shell.getBoundingClientRect();
  const cx   = rect.left + rect.width/2;
  const cy   = rect.top  + rect.height/2;
  const isFlipping = !shell.classList.contains("flipped");
  if(isFlipping){
    advanceCard(id);
    updateBackContent(id);
    spawnFlipStars(cx, cy, STAR_MAP[id] || STAR_COLORS_FC0);
  }
  shell.classList.toggle("flipped");
}

function renderDaily(){
  const row = document.getElementById("dailyRow");
  row.innerHTML = `
    <div class="flipShell" id="fc0" onclick="toggleFlip('fc0',event)">
      <div class="flipInner">
        <div class="flipFace flipFront">
          <div class="fTag">Asma' al-á¸¤usnÄ</div>
          <div class="fFrontContent">
            <div class="fLabel">Nome di Allah</div>
            <div class="fArabic" style="font-size:2.2rem;opacity:.75">Ø³ÙØ¨Ù’Ø­ÙØ§Ù†ÙÙ‡Ù ÙˆÙØªÙØ¹ÙØ§Ù„ÙÙ‰Ù°</div>
            <div class="fTitle" style="opacity:.55;font-size:.9rem;font-weight:500;margin-top:10px">gira per scoprire il nome di oggi</div>
          </div>
          <div class="fHint">tocca per girare â†º</div>
        </div>
        <div class="flipFace flipBack">
          <div class="fTag">Asma' al-á¸¤usnÄ</div>
          <div class="fBackContent"></div>
          <div class="fHint">tocca per il prossimo â†º</div>
        </div>
      </div>
    </div>

    <div class="flipShell" id="fc1" onclick="toggleFlip('fc1',event)">
      <div class="flipInner">
        <div class="flipFace flipFront">
          <div class="fTag">Sunnah</div>
          <div class="fFrontContent">
            <div class="fLabel">Carattere del Profeta</div>
            <div class="fArabic" style="font-size:2rem;opacity:.75">ï·º</div>
            <div class="fTitle" style="opacity:.55;font-size:.9rem;font-weight:500;margin-top:10px">gira per scoprire una virtÃ¹</div>
          </div>
          <div class="fHint">tocca per girare â†º</div>
        </div>
        <div class="flipFace flipBack">
          <div class="fTag">Sunnah</div>
          <div class="fBackContent"></div>
          <div class="fHint">tocca per il prossimo â†º</div>
        </div>
      </div>
    </div>

    <div class="flipShell" id="fc2" onclick="toggleFlip('fc2',event)">
      <div class="flipInner">
        <div class="flipFace flipFront">
          <div class="fTag">Ripeti oggi</div>
          <div class="fFrontContent">
            <div class="fLabel">DuÊ¼aÌ„ del giorno</div>
            <div class="fArabic" style="font-size:2rem;opacity:.75">Ø¯ÙØ¹ÙØ§Ø¡</div>
            <div class="fTitle" style="opacity:.55;font-size:.9rem;font-weight:500;margin-top:10px">gira per la supplica di oggi</div>
          </div>
          <div class="fHint">tocca per girare â†º</div>
        </div>
        <div class="flipFace flipBack">
          <div class="fTag">Ripeti oggi</div>
          <div class="fBackContent"></div>
          <div class="fHint">tocca per il prossimo â†º</div>
        </div>
      </div>
    </div>

    <div class="flipShell" id="fc3" onclick="toggleFlip('fc3',event)">
      <div class="flipInner">
        <div class="flipFace flipFront">
          <div class="fTag">Qur'an</div>
          <div class="fFrontContent">
            <div class="fLabel">Ä€ya del giorno</div>
            <div class="fArabic" style="font-size:2rem;opacity:.7">Ø¢ÙŠÙØ©</div>
            <div class="fTitle" style="opacity:.55;font-size:.9rem;font-weight:500;margin-top:10px">gira per il versetto di oggi</div>
          </div>
          <div class="fHint">tocca per girare â†º</div>
        </div>
        <div class="flipFace flipBack">
          <div class="fTag">Qur'an</div>
          <div class="fBackContent"></div>
          <div class="fHint">tocca per il prossimo â†º</div>
        </div>
      </div>
    </div>

    <div class="flipShell" id="fc4" onclick="toggleFlip('fc4',event)">
      <div class="flipInner">
        <div class="flipFace flipFront">
          <div class="fTag">Lo sapevi?</div>
          <div class="fFrontContent">
            <div class="fLabel">Corano & Scienza</div>
            <div class="fTitle" style="font-size:1.6rem;margin:8px 0">ğŸ”¬</div>
            <div class="fTitle" style="opacity:.55;font-size:.9rem;font-weight:500;margin-top:6px">gira per scoprire un fatto</div>
          </div>
          <div class="fHint">tocca per girare â†º</div>
        </div>
        <div class="flipFace flipBack">
          <div class="fTag">Lo sapevi?</div>
          <div class="fBackContent"></div>
          <div class="fHint">tocca per il prossimo â†º</div>
        </div>
      </div>
    </div>
  `;
  updateBackContent("fc0");
  updateBackContent("fc1");
  updateBackContent("fc2");
  updateBackContent("fc3");
  updateBackContent("fc4");
}
renderDaily();

/* =========================
   QUICK TEST (breve)
========================= */
function openQuickTest(){
  alert(
`TEST BREVE (30 secondi)
1) Oggi sto reagendo piÃ¹ che scegliere?
2) Sto cercando approvazione o veritÃ ?
3) Sto decidendo in fretta, sotto emozione?
4) Questa scelta mi avvicina ad Allah o mi addormenta?
Se 2+ risposte ti â€œpungonoâ€, usa lo strumento â€œCome ti senti?â€ e scegli â€œğŸ›¡ Protezioneâ€ o â€œğŸ§­ Consiglioâ€.`
  );
}

/* =========================
   UI OPTIONS
========================= */
const MOODS = [
  { key:"sad",     label:"ğŸ¤ Triste",       hint:"peso, mancanza, nostalgia" },
  { key:"anxious", label:"ğŸ˜° Ansioso",      hint:"paura, futuro, controllo" },
  { key:"angry",   label:"ğŸ”¥ Arrabbiato",   hint:"ingiustizia, irritazione" },
  { key:"guilty",  label:"ğŸ˜” In colpa",     hint:"errore, vergogna, ritorno" },
  { key:"empty",   label:"ğŸ«¥ Vuoto",        hint:"anestesia, rumore, fame" },
  { key:"confused",label:"ğŸ§­ Confuso",      hint:"troppo rumore, poca bussola" },
  { key:"hurt",    label:"ğŸ’” Ferito",       hint:"rifiuto, delusione, confini" },
  { key:"tempted", label:"ğŸª Tentato",      hint:"impulso, scuse, porta aperta" },
];

const NEEDS = [
  { key:"comfort",    label:"ğŸ•Š Conforto",    hint:"calma, speranza, ritorno" },
  { key:"advice",     label:"ğŸ§­ Consiglio",   hint:"passo giusto, ordine" },
  { key:"protection", label:"ğŸ›¡ Protezione",  hint:"difesa da pressioni/manipolazioni" },
  { key:"clarity",    label:"ğŸ” Chiarezza",   hint:"fatti, bias, discernimento" },
];

const MODES = [
  { key:"standard", label:"ğŸŒ¿ Centrale" },
  { key:"defense",  label:"ğŸ›¡ Difesa" },
  { key:"shaytan",  label:"ğŸ‘ Shayá¹­Än" },
  { key:"heart",    label:"ğŸ–¤ Cuore" },
  { key:"bias",     label:"ğŸ§  Bias & Neuro" },
];

/* =========================
   CONTENT (Qurâ€™an + Sunnah + semplice neuropsico)
   â†’ generazione: MOOD BASE + NEED MODS = TUTTE LE COMBINAZIONI
========================= */
const MOOD_BASE = {
  sad: {
    title: "Tristezza",
    quran: { ar:"Ù„ÙØ§ ØªÙÙ‚Ù’Ù†ÙØ·ÙÙˆØ§ Ù…ÙÙ† Ø±ÙÙ‘Ø­Ù’Ù…ÙØ©Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", it:"Non disperate della misericordia di Allah.", ref:"Qurâ€™an 39:53" },
    name:  { ar:"Ù±Ù„Ù’Ù„ÙÙ‘Ø·ÙÙŠÙ", it:"Al-Laá¹­Ä«f â€” Il Delicato", why:"Ti sostiene anche quando non lo senti." },
    sunnah:{ it:"Il credente non Ã¨ definito dal crollo, ma dal ritorno.", ref:"Senso della Sunnah: tornare ad Allah" },
    neuro: "La tristezza restringe la vista: ti fa leggere il presente come se fosse per sempre. Non Ã¨ veritÃ : Ã¨ uno stato.",
    trap:  "Trappola: interpretare il dolore come identitÃ  (â€œsono cosÃ¬â€).",
    micro: "Micro-azione: wudÅ«â€™ + 2 minuti di Qurâ€™an anche se non â€˜sentiâ€™ nulla.",
    akhirah:"Ricorda: il tempo scorre. Non lasciare che uno stato ti rubi la direzione."
  },

  anxious: {
    title: "Ansia",
    quran: { ar:"ÙˆÙÙ…ÙÙ† ÙŠÙØªÙÙˆÙÙƒÙÙ‘Ù„Ù’ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙÙÙ‡ÙÙˆÙ Ø­ÙØ³Ù’Ø¨ÙÙ‡Ù", it:"Chi si affida ad Allah, Egli gli Ã¨ sufficiente.", ref:"Qurâ€™an 65:3" },
    name:  { ar:"Ù±Ù„Ù’ÙˆÙÙƒÙÙŠÙ„", it:"Al-WakÄ«l â€” Il Custode", why:"Ti libera dallâ€™ossessione del risultato." },
    sunnah:{ it:"Tawakkul non Ã¨ passivitÃ : Ã¨ azione con cuore affidato.", ref:"Etica profetica" },
    neuro: "Lâ€™ansia Ã¨ un allarme del futuro: il cervello prova a controllare ciÃ² che non puÃ² controllare.",
    trap:  "Trappola: urgenza mentale â†’ decisioni rapide â†’ pentimento.",
    micro: "Micro-azione: 60 secondi di pausa + scrivi 1 fatto (non interpretazione).",
    akhirah:"Non vendere la tua luciditÃ  per un futuro immaginato: vivi il prossimo passo retto."
  },

  angry: {
    title: "Rabbia",
    quran: { ar:"ÙˆÙØ§Ù„Ù’ÙƒÙØ§Ø¸ÙÙ…ÙÙŠÙ†Ù Ø§Ù„Ù’ØºÙÙŠÙ’Ø¸Ù", it:"Coloro che trattengono la rabbiaâ€¦", ref:"Qurâ€™an 3:134" },
    name:  { ar:"Ù±Ù„Ù’Ø­ÙÙƒÙÙŠÙ…", it:"Al-á¸¤akÄ«m â€” Il Sapiente", why:"Ti insegna il tempo giusto e il confine giusto." },
    sunnah:{ it:"Il forte Ã¨ chi controlla la rabbia.", ref:"Bukhari e Muslim (senso)" },
    neuro: "La rabbia dÃ  energia ma ruba precisione. In questo stato, la lingua corre piÃ¹ veloce della saggezza.",
    trap:  "Trappola: rispondere subito per â€˜vincereâ€™ invece di essere giusto.",
    micro: "Micro-azione: cambia postura + respira lento 3 volte prima di parlare.",
    akhirah:"La vita Ã¨ breve: non sporcarla con una frase detta in un minuto."
  },

  guilty: {
    title: "Colpa",
    quran: { ar:"ÙˆÙÙ…ÙÙ† ÙŠÙØ¹Ù’Ù…ÙÙ„Ù’ Ø³ÙÙˆØ¡Ù‹Ø§ ... Ø«ÙÙ…ÙÙ‘ ÙŠÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØ¬ÙØ¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØºÙÙÙÙˆØ±Ù‹Ø§ Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù‹Ø§", it:"Chi sbaglia e poi chiede perdono troverÃ  Allah perdonatore e misericordioso.", ref:"Qurâ€™an 4:110" },
    name:  { ar:"Ù±Ù„Ù’ØºÙÙÙÙˆØ±", it:"Al-GhafÅ«r â€” Il Perdonatore", why:"La porta del ritorno non si chiude finchÃ© respiri." },
    sunnah:{ it:"Il miglior â€˜dopo erroreâ€™ Ã¨ tawbah concreta, non auto-punizione infinita.", ref:"Senso della Sunnah" },
    neuro: "La colpa sana spinge al cambiamento. La colpa tossica ti paralizza e ti consuma senza azione.",
    trap:  "Trappola: confondere vergogna (â€œsono sbagliatoâ€) con responsabilitÃ  (â€œho sbagliatoâ€).",
    micro: "Micro-azione: 1) istighfÄr 10 volte 2) 1 scelta diversa oggi.",
    akhirah:"Il tempo scorre: torna ad Allah ora, non â€˜domaniâ€™."
  },

  empty: {
    title: "Vuoto",
    quran: { ar:"Ø£ÙÙ„ÙØ§ Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù", it:"Nel ricordo di Allah i cuori trovano pace.", ref:"Qurâ€™an 13:28" },
    name:  { ar:"Ù±Ù„Ù’Ù‡ÙØ§Ø¯ÙÙŠ", it:"Al-HÄdÄ« â€” Il Guida", why:"Quando ti perdi, ti riporta al senso." },
    sunnah:{ it:"La costanza, anche piccola, costruisce cuore e mente.", ref:"Bukhari e Muslim (senso)" },
    neuro: "Il cervello cerca stimoli per non sentire il vuoto. Ma lo stimolo calma per poco e poi chiede di piÃ¹.",
    trap:  "Trappola: anestesia (scroll, rumore) invece di nutrimento reale.",
    micro: "Micro-azione: 20 minuti senza schermo + 2 minuti dhikr/Qurâ€™an.",
    akhirah:"Non cercare il Paradiso in questo mondo: usa il mondo per il Paradiso."
  },

  confused: {
    title: "Confusione",
    quran: { ar:"ÙˆÙØ§ØªÙÙ‘Ù‚ÙÙˆØ§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Û– ÙˆÙÙŠÙØ¹ÙÙ„ÙÙ‘Ù…ÙÙƒÙÙ…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", it:"Abbiate taqwa e Allah vi insegnerÃ .", ref:"Qurâ€™an 2:282 (parte)" },
    name:  { ar:"Ù±Ù„Ù’Ù‡ÙØ§Ø¯ÙÙŠ", it:"Al-HÄdÄ« â€” Il Guida", why:"La bussola torna quando riduci rumore e sinceritÃ  aumenta." },
    sunnah:{ it:"Lascia ciÃ² che ti mette in dubbio per ciÃ² che non ti mette in dubbio.", ref:"Tirmidhi" },
    neuro: "La confusione spesso Ã¨ troppa informazione e pochi valori espliciti. Il cervello â€˜negoziaâ€™ da zero ogni volta.",
    trap:  "Trappola: cercare ancora input invece di scegliere un criterio.",
    micro: "Micro-azione: scrivi 3 valori non negoziabili. Poi guarda la scelta alla luce di essi.",
    akhirah:"Il tempo Ã¨ capitale: scegli rettitudine, non perfezione."
  },

  hurt: {
    title: "Ferita / Rifiuto",
    quran: { ar:"Ø¥ÙÙ†ÙÙ‘ Ø£ÙÙƒÙ’Ø±ÙÙ…ÙÙƒÙÙ…Ù’ Ø¹ÙÙ†Ø¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØªÙ’Ù‚ÙØ§ÙƒÙÙ…Ù’", it:"Il piÃ¹ nobile presso Allah Ã¨ il piÃ¹ pio.", ref:"Qurâ€™an 49:13 (parte)" },
    name:  { ar:"Ù±Ù„Ù’Ø¹ÙØ²ÙÙŠØ²", it:"Al-â€˜AzÄ«z â€” Il Potente", why:"La tua dignitÃ  non dipende dagli uomini." },
    sunnah:{ it:"Non inseguire approvazione a prezzo della tua religione.", ref:"Senso della Sunnah" },
    neuro: "Il rifiuto attiva dolore reale. Il rischio Ã¨ trasformarlo in dipendenza da validazione.",
    trap:  "Trappola: inseguire chi ti dÃ  poco per â€˜riparareâ€™ la ferita.",
    micro: "Micro-azione: 1 confine breve e chiaro + 1 buona azione invisibile.",
    akhirah:"La vita Ã¨ breve: non metterla nelle mani di chi cambia umore."
  },

  tempted: {
    title: "Tentazione",
    quran: { ar:"ÙˆÙØ£ÙÙ…ÙÙ‘Ø§ Ù…ÙÙ†Ù’ Ø®ÙØ§ÙÙ Ù…ÙÙ‚ÙØ§Ù…Ù Ø±ÙØ¨ÙÙ‘Ù‡Ù ÙˆÙÙ†ÙÙ‡ÙÙ‰ Ø§Ù„Ù†ÙÙ‘ÙÙ’Ø³Ù Ø¹ÙÙ†Ù Ø§Ù„Ù’Ù‡ÙÙˆÙÙ‰Ù° ÙÙØ¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù Ù‡ÙÙŠÙ Ø§Ù„Ù’Ù…ÙØ£Ù’ÙˆÙÙ‰Ù°", it:"Chi teme il suo Signore e frena il desiderio: il Paradiso sarÃ  la dimora.", ref:"Qurâ€™an 79:40-41" },
    name:  { ar:"Ù±Ù„Ù’Ù‚ÙÙˆÙÙŠÙ‘", it:"Al-Qawiyy â€” Il Forte", why:"La forza vera Ã¨ controllo dellâ€™impulso." },
    sunnah:{ it:"Taglia la porta: cambia ambiente, riduci esposizione, non discutere con lâ€™impulso.", ref:"Senso della Sunnah" },
    neuro: "Lâ€™impulso chiede sollievo immediato. La mente inventa scuse (â€˜solo oggiâ€™) per ridurre la tensione.",
    trap:  "Trappola: â€˜solo questa voltaâ€™ â†’ la catena si rinforza.",
    micro: "Micro-azione: cambia luogo ORA + chiudi trigger per 24h.",
    akhirah:"Non vendere lâ€™eterno per un minuto."
  }
};

const NEED_MODS = {
  comfort: {
    goal: "Calmare e sostenere (senza addormentare).",
    prompt: "In questo momento non serve dimostrare forza: serve tornare al Centro.",
    actionExtra: "Scegli una pratica piccola: wudÅ«â€™, dhikr, 2 rakâ€˜Ät, o 2 minuti Qurâ€™an.",
    biasHint: "Quando il cuore Ã¨ basso, il cervello generalizza: â€˜sempre / maiâ€™. Non credergli."
  },
  advice: {
    goal: "Passo giusto, concreto, sostenibile.",
    prompt: "Non cercare il â€˜piano perfettoâ€™. Cerca il prossimo gesto giusto.",
    actionExtra: "Scrivi: 1 fatto, 1 scelta, 1 micro-azione oggi.",
    biasHint: "Evita il â€˜domani inizioâ€™: sposta il primo passo a adesso (anche 2 minuti)."
  },
  protection: {
    goal: "Protezione da pressione, colpa, urgenza, manipolazione.",
    prompt: "Quando sei emotivo sei piÃ¹ vulnerabile: rallenta, verifica, prendi tempo.",
    actionExtra: "Regola dâ€™oro: niente decisioni importanti in urgenza. Aspetta 24h.",
    biasHint: "Attenzione a: urgenza/scarsitÃ , autoritÃ  apparente, social proof, colpevolizzazione."
  },
  clarity: {
    goal: "Fatti, discernimento, uscire dal loop mentale.",
    prompt: "Separa: fatto vs interpretazione. Emozione vs prova.",
    actionExtra: "Riformula: â€˜Cosa so davvero?â€™ â€˜Cosa sto immaginando?â€™",
    biasHint: "Emotional reasoning: â€˜mi sento cosÃ¬ â†’ quindi Ã¨ veroâ€™. No: verifica."
  }
};

/* =========================
   MODES (lenti)
========================= */
function applyMode(card, mode){
  const c = JSON.parse(JSON.stringify(card));
  const MODE_OVERRIDES = {
    defense: {
      neuro: "Quando sei emotivo, il cervello cerca sollievo rapido: Ã¨ il momento in cui urgenza, pressione e â€˜autoritÃ â€™ sembrano piÃ¹ convincenti di quanto siano.",
      trap:  "Trappola: urgenza/pressione â†’ decidi subito â†’ perdi luciditÃ  e confini.",
      micro: "Regola: aspetta 24 ore. Chiedi prove. Verifica la fonte. Consulta una persona saggia.",
      akhirah:"La vita Ã¨ breve: non vendere la tua luciditÃ  per una spinta emotiva di un momento."
    },
    shaytan: {
      neuro: "Shayá¹­Än lavora con waswasa: ripetizione, normalizzazione, fretta, isolamento. Ti spinge a reagire, non a scegliere.",
      trap:  "Trappola: â€˜solo per oggiâ€™ / â€˜tanto ormaiâ€™ / â€˜nessuno lo saâ€™.",
      micro: "DÃ¬ istiâ€˜Ädhah. Cambia ambiente. Taglia lâ€™esposizione al trigger per 24 ore. Torna a dhikr/salah.",
      akhirah:"Ricorda Al-â€˜Aá¹£r: il tempo scorre. Shayá¹­Än vuole che tu lo sprechi in reazione e negligenza."
    },
    heart: {
      neuro: "Le malattie del cuore entrano travestite: riyaâ€™ (apparenza), hasad (confronto), kibir (orgoglio), ghaflah (distrazione). Sono abitudini del cuore.",
      trap:  "Trappola: nutrire confronto, cercare approvazione, difendere lâ€™ego, dimenticare Allah nel quotidiano.",
      micro: "Cura: 1 azione invisibile oggi (solo per Allah) + 3 minuti muá¸¥Äsabah prima di dormire.",
      akhirah:"La vita Ã¨ breve: purifica il cuore ora, perchÃ© Ã¨ ciÃ² che porterai con te."
    },
    bias: {
      neuro: "Con emozioni intense, la mente usa scorciatoie: conferma, confronto, urgenza, e â€˜sento quindi Ã¨ veroâ€™. Serve pausa e verifica.",
      trap:  "Trappola: confondere emozione con prova. Un sentimento non Ã¨ un fatto.",
      micro: "Pausa 60s. Chiediti: Qual Ã¨ il fatto? Qual Ã¨ lâ€™interpretazione? Sono la stessa cosa?",
      akhirah:"La vita Ã¨ breve: non vivere in automatico. Sei stato creato per scegliere."
    }
  };
  if(mode === "standard" || !MODE_OVERRIDES[mode]) return c;
  const o = MODE_OVERRIDES[mode];
  c.neuro  = o.neuro  || c.neuro;
  c.trap   = o.trap   || c.trap;
  c.micro  = o.micro  || c.micro;
  c.akhirah= o.akhirah|| c.akhirah;
  return c;
}

/* =========================
   LETTERS (2 varianti) + HADITH DA RIPETERE
========================= */
const LETTERS = {
  sad: {
    collapse: {
      title: "Lettera a te stesso (quando sei triste e stai per crollare)",
      text: [
        "Respira. Non devi dimostrare forza adesso. Devi solo restare vivo dentro.",
        "La tristezza restringe la vista: ti fa credere che questa fase sia la tua identitÃ . Non lo Ã¨.",
        "Non sei solo: anche se non senti nulla, Allah ti vede. E il fatto che tu stia cercando Ã¨ giÃ  un ritorno.",
        "Fai una cosa piccola e pulita: wudÅ«â€™, due rakâ€˜Ät, o istighfÄr lento. Basta questo per oggi."
      ],
      signature: "â€” Non correre. Torna."
    },
    rise: {
      title: "Lettera a te stesso (quando sei triste e vuoi rialzarti)",
      text: [
        "Non aspettare che passi per agire: lâ€™azione Ã¨ una porta che fa entrare luce.",
        "Scegli un passo minuscolo ma reale. La costanza cambia piÃ¹ della motivazione.",
        "Non nutrire confronto e rumore: ti svuotano. Nutri Qurâ€™an e presenza: ti ricentrano.",
        "Oggi non serve â€˜tuttoâ€™. Serve il prossimo gesto giusto."
      ],
      signature: "â€” Un passo pulito."
    }
  },

  anxious: {
    collapse: {
      title: "Lettera a te stesso (quando lâ€™ansia ti schiaccia)",
      text: [
        "Lâ€™ansia Ã¨ lâ€™allarme del futuro. Non Ã¨ profezia: Ã¨ un segnale.",
        "Riduci tutto a: cosa Ã¨ vero adesso? Il resto Ã¨ immaginazione dolorosa.",
        "Allah non ti chiede di controllare il risultato. Ti chiede di scegliere il bene possibile.",
        "Chiudi input per un momento. Respira. DÃ¬: HasbiyallÄh. Poi fai un passo piccolo."
      ],
      signature: "â€” Torna al presente."
    },
    rise: {
      title: "Lettera a te stesso (quando vuoi riprendere luciditÃ  dallâ€™ansia)",
      text: [
        "Il cervello ansioso sovrastima il rischio e sottostima le tue risorse.",
        "Fai un protocollo semplice: 1 fatto, 1 azione, 1 duâ€˜Ä.",
        "Non decidere in urgenza: lâ€™ansia ama la fretta. Prenditi tempo e verifica.",
        "La tua parte Ã¨ agire bene. Il risultato Ã¨ affidato ad Allah."
      ],
      signature: "â€” Tawakkul + azione."
    }
  },

  angry: {
    collapse: {
      title: "Lettera a te stesso (quando la rabbia ti sta prendendo)",
      text: [
        "In questo stato vuoi vincere, non capire. E Shayá¹­Än ama la fretta.",
        "Non rispondere ora: la prima risposta Ã¨ spesso la piÃ¹ ingiusta.",
        "Cambia postura. Respira. Se puoi, fai wudÅ«â€™. Raffredda il corpo per raffreddare la mente.",
        "La tua dignitÃ  Ã¨ scegliere adab quando lâ€™impulso vuole caos."
      ],
      signature: "â€” La calma Ã¨ forza."
    },
    rise: {
      title: "Lettera a te stesso (quando vuoi trasformare la rabbia in giustizia)",
      text: [
        "La rabbia Ã¨ informazione: un valore Ã¨ stato toccato. Ma non decide lei come reagire.",
        "Chiediti: voglio giustizia o vendetta? La giustizia ha confini, la vendetta distrugge.",
        "Parla solo quando puoi essere preciso e rispettoso. Se non puoi, aspetta.",
        "Metti un confine con adab: breve, chiaro, senza umiliare."
      ],
      signature: "â€” Scegli il bene."
    }
  },

  guilty: {
    collapse: {
      title: "Lettera a te stesso (quando la colpa ti fa perdere speranza)",
      text: [
        "La colpa sana Ã¨ misericordia: significa che il cuore Ã¨ vivo.",
        "Ma non trasformarla in tortura: Allah vuole ritorno, non disperazione.",
        "Non dire: â€˜sono finitoâ€™. Diâ€™ piuttosto: â€˜posso tornareâ€™.",
        "Adesso: istighfÄr lento. Poi una scelta diversa, anche piccola."
      ],
      signature: "â€” Ritorna oggi."
    },
    rise: {
      title: "Lettera a te stesso (quando vuoi fare tawbah concreta)",
      text: [
        "Tawbah Ã¨ semplice: riconosci, chiedi perdono, cambia una cosa concreta.",
        "Non promettere tutto: costruisci una barriera reale (ambiente, routine, persone).",
        "Non fidarti solo della forza di volontÃ : progetta protezione.",
        "Allah ripara ciÃ² che tu spezzi quando torni con sinceritÃ ."
      ],
      signature: "â€” Ripara e costruisci."
    }
  },

  empty: {
    collapse: {
      title: "Lettera a te stesso (quando senti il vuoto e vuoi anestetizzarti)",
      text: [
        "Il vuoto non Ã¨ un nemico: Ã¨ un segnale che ti manca nutrimento vero.",
        "Lo stimolo riempie per un attimo e poi lascia piÃ¹ fame.",
        "Non scappare nel rumore. Siediti un momento e torna al dhikr, anche poco.",
        "Allah non ti chiede di â€˜sentireâ€™ subito. Ti chiede di tornare."
      ],
      signature: "â€” Non anestetizzare."
    },
    rise: {
      title: "Lettera a te stesso (quando vuoi riempire il vuoto con senso)",
      text: [
        "Il cuore non si sazia con cose: si sazia con direzione.",
        "Scegli: Qurâ€™an, salah, servizio. Anche una sola azione oggi.",
        "Riduci input inutili: proteggi occhi e orecchie. CiÃ² che guardi ti cambia.",
        "Il vuoto puÃ² diventare porta di crescita, se lo orienti ad Allah."
      ],
      signature: "â€” Nutri il cuore."
    }
  },

  confused: {
    collapse: {
      title: "Lettera a te stesso (quando la confusione ti blocca)",
      text: [
        "La confusione spesso Ã¨ troppo rumore e troppe opinioni addosso.",
        "Non consumare altro per â€˜capireâ€™: spegni e riduci input per qualche ora.",
        "Allah guida chi Lo cerca. Tu fai un passo retto, non perfetto.",
        "Scegli ciÃ² che Ã¨ piÃ¹ halal e piÃ¹ giusto. Il resto si chiarirÃ ."
      ],
      signature: "â€” Rallenta."
    },
    rise: {
      title: "Lettera a te stesso (quando vuoi ordine e chiarezza)",
      text: [
        "La bussola Ã¨: valori + intenzione + prossimo passo.",
        "Scrivi 3 valori non negoziabili. Poi chiediti: questa scelta li rispetta?",
        "Non delegare la tua mente a chi parla bene: chiedi prove e fonti.",
        "La chiarezza spesso arriva dopo un passo coerente."
      ],
      signature: "â€” Chiedi. Scegli."
    }
  },

  hurt: {
    collapse: {
      title: "Lettera a te stesso (quando sei ferito e vuoi inseguire approvazione)",
      text: [
        "Quando sei ferito, cerchi â€˜riparazioneâ€™ dagli uomini. Ma la dignitÃ  non nasce lÃ¬.",
        "Non mendicare valore da chi ti dÃ  poco. Questo aumenta la ferita.",
        "Mettere confini non Ã¨ cattiveria: Ã¨ protezione del cuore.",
        "Torna ad Allah prima di tornare agli uomini."
      ],
      signature: "â€” La tua dignitÃ  Ã¨ con Allah."
    },
    rise: {
      title: "Lettera a te stesso (quando vuoi guarire con saggezza)",
      text: [
        "Guarire Ã¨: confini, persone giuste, tempo, e Allah.",
        "Non diventare duro: diventa lucido. Lâ€™adab Ã¨ forza.",
        "Scegli una relazione pulita e vera, non molte superficiali.",
        "Fai una buona azione invisibile oggi: ricostruisce il cuore."
      ],
      signature: "â€” Ricostruisci."
    }
  },

  tempted: {
    collapse: {
      title: "Lettera a te stesso (quando la tentazione Ã¨ forte adesso)",
      text: [
        "La tentazione Ã¨ un momento. Non Ã¨ la tua identitÃ .",
        "Shayá¹­Än ama: â€˜solo per oggiâ€™. Taglia la catena: cambia ambiente ORA.",
        "Non discutere con lâ€™impulso: chiudi la porta (trigger, schermo, chat).",
        "DÃ¬ istiâ€˜Ädhah. Poi fai un gesto fisico: acqua, luce, cammino."
      ],
      signature: "â€” Taglia la porta."
    },
    rise: {
      title: "Lettera a te stesso (quando vuoi proteggerti a lungo termine)",
      text: [
        "La volontÃ  Ã¨ limitata. Lâ€™ambiente vince: progetta barriere.",
        "Riduci esposizione: ciÃ² che guardi e ascolti ti modella.",
        "Sostituisci: non basta togliere. Metti Qurâ€™an, attivitÃ , persone sane.",
        "Non svendere lâ€™eterno per un minuto: scegli ciÃ² che ti rende libero."
      ],
      signature: "â€” Proteggi il futuro."
    }
  }
};

const PROPHET_QUOTES = {
  sad: {
    collapse: { ar:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù Ø§Ù„Ù’Ù‡ÙÙ…ÙÙ‘ ÙˆÙØ§Ù„Ù’Ø­ÙØ²ÙÙ†Ù", it:"O Allah, cerco rifugio in Te dallâ€™angoscia e dalla tristezza.", ref:"Duâ€˜Ä profetica" },
    rise:     { ar:"Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø§Ù„ØµÙÙ‘Ø¨Ù’Ø±Ù Ø¹ÙÙ†Ù’Ø¯Ù Ø§Ù„ØµÙÙ‘Ø¯Ù’Ù…ÙØ©Ù Ø§Ù„Ù’Ø£ÙÙˆÙ„ÙÙ‰", it:"La vera pazienza Ã¨ al primo impatto.", ref:"Bukhari e Muslim" }
  },
  anxious: {
    collapse: { ar:"Ø­ÙØ³Ù’Ø¨ÙÙŠÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ", it:"Allah mi basta. Non câ€™Ã¨ divinitÃ  se non Lui.", ref:"Dhikr profetico" },
    rise:     { ar:"Ù„ÙÙˆÙ’ Ø£ÙÙ†ÙÙ‘ÙƒÙÙ…Ù’ ØªÙØªÙÙˆÙÙƒÙÙ‘Ù„ÙÙˆÙ†Ù Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø­ÙÙ‚ÙÙ‘ ØªÙÙˆÙÙƒÙÙ‘Ù„ÙÙ‡Ù...", it:"Se vi affidaste ad Allah come si deveâ€¦", ref:"Tirmidhi" }
  },
  angry: {
    collapse: { ar:"Ù„ÙØ§ ØªÙØºÙ’Ø¶ÙØ¨Ù’", it:"Non arrabbiarti.", ref:"Bukhari" },
    rise:     { ar:"Ù„ÙÙŠÙ’Ø³Ù Ø§Ù„Ø´ÙÙ‘Ø¯ÙÙŠØ¯Ù Ø¨ÙØ§Ù„ØµÙÙ‘Ø±ÙØ¹ÙØ©Ù...", it:"Il forte non Ã¨ chi vince nella lotta, ma chi controlla la rabbia.", ref:"Bukhari e Muslim" }
  },
  guilty: {
    collapse: { ar:"Ø§Ù„ØªÙÙ‘Ø§Ø¦ÙØ¨Ù Ù…ÙÙ†Ù Ø§Ù„Ø°ÙÙ‘Ù†Ù’Ø¨Ù ÙƒÙÙ…ÙÙ†Ù’ Ù„ÙØ§ Ø°ÙÙ†Ù’Ø¨Ù Ù„ÙÙ‡Ù", it:"Chi si pente dal peccato Ã¨ come chi non ha peccato.", ref:"Ibn MÄjah" },
    rise:     { ar:"ÙƒÙÙ„ÙÙ‘ Ø¨ÙÙ†ÙÙŠ Ø¢Ø¯ÙÙ…Ù Ø®ÙØ·ÙÙ‘Ø§Ø¡ÙŒ... ÙˆÙØ®ÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ø®ÙØ·ÙÙ‘Ø§Ø¦ÙÙŠÙ†Ù Ø§Ù„ØªÙÙ‘ÙˆÙÙ‘Ø§Ø¨ÙÙˆÙ†Ù", it:"Tutti sbaglianoâ€¦ e i migliori sono quelli che si pentono.", ref:"Tirmidhi" }
  },
  empty: {
    collapse: { ar:"Ø£ÙÙ„ÙØ§ Ø¥ÙÙ†ÙÙ‘ ÙÙÙŠ Ø§Ù„Ù’Ø¬ÙØ³ÙØ¯Ù Ù…ÙØ¶Ù’ØºÙØ©Ù‹...", it:"Nel corpo câ€™Ã¨ un pezzo di carneâ€¦ Ã¨ il cuore.", ref:"Bukhari e Muslim" },
    rise:     { ar:"Ø£ÙØ­ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø£ÙØ¹Ù’Ù…ÙØ§Ù„Ù Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ¯Ù’ÙˆÙÙ…ÙÙ‡ÙØ§ ÙˆÙØ¥ÙÙ†Ù’ Ù‚ÙÙ„ÙÙ‘", it:"Le opere piÃ¹ amate sono quelle costanti, anche se piccole.", ref:"Bukhari e Muslim" }
  },
  confused: {
    collapse: { ar:"Ø¯ÙØ¹Ù’ Ù…ÙØ§ ÙŠÙØ±ÙÙŠØ¨ÙÙƒÙ Ø¥ÙÙ„ÙÙ‰ Ù…ÙØ§ Ù„ÙØ§ ÙŠÙØ±ÙÙŠØ¨ÙÙƒÙ", it:"Lascia ciÃ² che ti mette in dubbio per ciÃ² che non ti mette in dubbio.", ref:"Tirmidhi" },
    rise:     { ar:"Ù…ÙÙ†Ù’ Ø³ÙÙ„ÙÙƒÙ Ø·ÙØ±ÙÙŠÙ‚Ù‹Ø§ ÙŠÙÙ„Ù’ØªÙÙ…ÙØ³Ù ÙÙÙŠÙ‡Ù Ø¹ÙÙ„Ù’Ù…Ù‹Ø§...", it:"Chi percorre una via per cercare conoscenzaâ€¦", ref:"Muslim" }
  },
  hurt: {
    collapse: { ar:"Ø§Ø±Ù’Ø­ÙÙ…ÙÙˆØ§ Ù…ÙÙ†Ù’ ÙÙÙŠ Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù ÙŠÙØ±Ù’Ø­ÙÙ…Ù’ÙƒÙÙ…Ù’ Ù…ÙÙ†Ù’ ÙÙÙŠ Ø§Ù„Ø³ÙÙ‘Ù…ÙØ§Ø¡Ù", it:"Siate misericordiosiâ€¦ e il Misericordioso vi farÃ  misericordia.", ref:"Tirmidhi" },
    rise:     { ar:"Ù„ÙØ§ ÙŠÙØ­ÙÙ„ÙÙ‘ Ù„ÙÙ…ÙØ³Ù’Ù„ÙÙ…Ù Ø£ÙÙ†Ù’ ÙŠÙÙ‡Ù’Ø¬ÙØ±Ù Ø£ÙØ®ÙØ§Ù‡Ù...", it:"Non Ã¨ lecito abbandonare oltre tre giorni.", ref:"Bukhari" }
  },
  tempted: {
    collapse: { ar:"Ø­ÙÙÙÙ‘ØªÙ Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù Ø¨ÙØ§Ù„Ù’Ù…ÙÙƒÙØ§Ø±ÙÙ‡Ù...", it:"Il Paradiso Ã¨ circondato da difficoltÃ â€¦", ref:"Muslim" },
    rise:     { ar:"Ù…ÙÙ†Ù’ ÙŠÙØªÙØµÙØ¨ÙÙ‘Ø±Ù’ ÙŠÙØµÙØ¨ÙÙ‘Ø±Ù’Ù‡Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", it:"Chi si sforza di essere paziente, Allah gli concede pazienza.", ref:"Bukhari" }
  }
};

/* =========================
   STATE
========================= */
let selectedMood = null;
let selectedNeed = null;
let selectedMode = "standard";

/* =========================
   BUILD UI
========================= */
function resetModeToCentral(){
  selectedMode = "standard";
  document.querySelectorAll("#modes .btn").forEach(x => x.classList.remove("active"));
  const defaultBtn = document.querySelector('#modes .btn[data-key="standard"]');
  if(defaultBtn) defaultBtn.classList.add("active");
}

function buildButtons(){
  // moods
  const moodsEl = document.getElementById("moods");
  moodsEl.innerHTML = "";
  MOODS.forEach(m => {
    const b = document.createElement("button");
    b.className = "btn" + (m.key === selectedMood ? " active" : "");
    b.dataset.key = m.key;
    b.innerHTML = `<div><div style="font-weight:800">${escapeHtml(m.label)}</div><small>${escapeHtml(m.hint)}</small></div><div style="opacity:.55">â†’</div>`;
    b.onclick = () => {
      selectedMood = m.key;
      // default centrale ogni volta
      resetModeToCentral();
      document.querySelectorAll("#moods .btn").forEach(x => x.classList.remove("active"));
      b.classList.add("active");
      tryRender();
    };
    moodsEl.appendChild(b);
  });

  // needs
  const needsEl = document.getElementById("needs");
  needsEl.innerHTML = "";
  NEEDS.forEach(n => {
    const b = document.createElement("button");
    b.className = "btn" + (n.key === selectedNeed ? " active" : "");
    b.dataset.key = n.key;
    b.innerHTML = `<div><div style="font-weight:800">${escapeHtml(n.label)}</div><small>${escapeHtml(n.hint)}</small></div><div style="opacity:.55">â†’</div>`;
    b.onclick = () => {
      selectedNeed = n.key;
      // default centrale ogni volta
      resetModeToCentral();
      document.querySelectorAll("#needs .btn").forEach(x => x.classList.remove("active"));
      b.classList.add("active");
      tryRender();
    };
    needsEl.appendChild(b);
  });

  // modes
  const modesEl = document.getElementById("modes");
  modesEl.innerHTML = "";
  MODES.forEach(m => {
    const b = document.createElement("button");
    b.className = "btn" + (m.key === selectedMode ? " active" : "");
    b.dataset.key = m.key;
    b.style.minWidth = "190px";
    b.innerHTML = `<div><div style="font-weight:800">${escapeHtml(m.label)}</div><small>Lente</small></div><div style="opacity:.55">â†º</div>`;
    b.onclick = () => {
      selectedMode = m.key;
      document.querySelectorAll("#modes .btn").forEach(x => x.classList.remove("active"));
      b.classList.add("active");
      tryRender();
    };
    modesEl.appendChild(b);
  });

  // ensure central active
  resetModeToCentral();
}

buildButtons();

/* =========================
   CARD GENERATION (tutte le combinazioni)
========================= */
function buildCard(moodKey, needKey){
  const base = MOOD_BASE[moodKey];
  const mod  = NEED_MODS[needKey];
  if(!base || !mod) return null;

  // Duâ€˜Ä (scegliamo una adatta, semplice)
  const duaByNeed = {
    comfort:    DAILY_DUA[1],
    advice:     DAILY_DUA[0],
    protection: DAILY_DUA[3],
    clarity:    DAILY_DUA[4],
  };
  const dua = duaByNeed[needKey] || pickDaily(DAILY_DUA);

  // Micro-azioni: base + extra
  const micro = `${base.micro} ${mod.actionExtra}`;

  // Riassunto centrale: molto semplice ma â€œparlaâ€
  const summary = `${mod.prompt}`;

  return {
    moodTitle: base.title,
    needTitle: NEEDS.find(n=>n.key===needKey)?.label || needKey,
    goal: mod.goal,

    quran: base.quran,

    name: base.name,
    sunnah: base.sunnah,

    dua: { ar: dua.ar, it: dua.it, ref: dua.ref },

    psychoTitle: "Cosa sta succedendo dentro di te",
    neuro: base.neuro,

    influenceTitle: "Cosa ti influenza (bias / ambiente / input)",
    influence: mod.biasHint,

    trapTitle: "Trappola da evitare",
    trap: base.trap,

    actionTitle: "Micro-azione (adesso)",
    micro: micro,

    summaryTitle: "Messaggio centrale",
    summary,

    akhirahTitle: "Ricordo (vita breve â†’ responsabilitÃ )",
    akhirah: base.akhirah
  };
}

/* =========================
   RENDER
========================= */
function tryRender(){
  const out = document.getElementById("output");

  if(!selectedMood || !selectedNeed){
    out.style.display = "none";
    out.innerHTML = "";
    return;
  }

  const baseCard = buildCard(selectedMood, selectedNeed);
  if(!baseCard){
    out.style.display="none";
    out.innerHTML="";
    return;
  }

  const card = applyMode(baseCard, selectedMode);

  const showLetter = (selectedMode === "standard");
  const letterVariant = (selectedNeed === "comfort") ? "collapse" : "rise";
  const letter = LETTERS[selectedMood]?.[letterVariant];
  const prophet = PROPHET_QUOTES[selectedMood]?.[letterVariant];

  out.style.display = "block";

  out.innerHTML = `
    <div class="outTop">
      <div>
        <div class="outTitle">${escapeHtml(card.needTitle)} â€” ${escapeHtml(card.moodTitle)}</div>
        <div class="muted" style="margin-top:6px;line-height:1.6">
          <span class="pill">ğŸ¯ ${escapeHtml(card.goal)}</span>
          <span class="pill">ğŸŒ¿ ModalitÃ : ${escapeHtml(MODES.find(m=>m.key===selectedMode)?.label || selectedMode)}</span>
        </div>
      </div>
      <div class="pill">ğŸ§  Comprendere â†’ scegliere â†’ tornare</div>
    </div>

    <div class="cols">
      <div style="display:grid; gap:12px;">
        <div class="block">
          <h3>${escapeHtml(card.summaryTitle)}</h3>
          <p><strong>${escapeHtml(card.summary)}</strong></p>
        </div>

        <div class="block">
          <h3>ğŸ“– Qurâ€™an</h3>
          <div class="arabic">${escapeHtml(card.quran.ar)}</div>
          <p><strong>${escapeHtml(card.quran.it)}</strong></p>
          <div class="ref">${escapeHtml(card.quran.ref)}</div>
        </div>

        <div class="block">
          <h3>ğŸ¤ Nome di Allah & Sunnah</h3>
          <div class="list">
            <div class="item"><span class="dot">A</span><div>
              <strong class="arabic" style="display:block;margin-top:-2px">${escapeHtml(card.name.ar)}</strong>
              <div><strong>${escapeHtml(card.name.it)}</strong> â€” ${escapeHtml(card.name.why)}</div>
            </div></div>
            <div class="item"><span class="dot">S</span><div>
              <strong>${escapeHtml(card.sunnah.it)}</strong>
              <div class="ref">${escapeHtml(card.sunnah.ref)}</div>
            </div></div>
          </div>
        </div>

        <div class="block">
          <h3>ğŸ¤² Duâ€˜Ä</h3>
          <div class="arabic">${escapeHtml(card.dua.ar)}</div>
          <p><strong>${escapeHtml(card.dua.it)}</strong></p>
          <div class="ref">${escapeHtml(card.dua.ref)}</div>
        </div>

        ${(showLetter && letter && prophet) ? `
          <div class="letter">
            <h3>âœ‰ï¸ ${escapeHtml(letter.title)}</h3>
            <p>${letter.text.map(t => escapeHtml(t)).join("<br><br>")}</p>
            <div class="sig">${escapeHtml(letter.signature || "")}</div>

            <div class="block" style="margin-top:12px;">
              <h3>ğŸ¤ Detto del Profeta ï·º da ripetere oggi</h3>
              <div class="arabic">${escapeHtml(prophet.ar)}</div>
              <p><strong>${escapeHtml(prophet.it)}</strong></p>
              <div class="ref">${escapeHtml(prophet.ref)}</div>
            </div>
          </div>
        ` : ``}
      </div>

      <div style="display:grid; gap:12px;">
        <div class="block">
          <h3>${escapeHtml(card.psychoTitle)}</h3>
          <p>${escapeHtml(card.neuro)}</p>
        </div>

        <div class="block">
          <h3>${escapeHtml(card.influenceTitle)}</h3>
          <p>${escapeHtml(card.influence)}</p>
          <div class="footnote">
            Principio: <strong>ciÃ² che vedi, ascolti e â€œadoriâ€ ti modella</strong>. Proteggi input e ambiente: proteggi lâ€™identitÃ .
          </div>
        </div>

        <div class="block">
          <h3>${escapeHtml(card.trapTitle)}</h3>
          <p><span class="danger">Attenzione:</span> ${escapeHtml(card.trap)}</p>
        </div>

        <div class="block">
          <h3>${escapeHtml(card.actionTitle)}</h3>
          <p>${escapeHtml(card.micro)}</p>
        </div>

        <div class="block">
          <h3>${escapeHtml(card.akhirahTitle)}</h3>
          <p>${escapeHtml(card.akhirah)}</p>
          <div class="ref">Suggerimento: dopo questo, fai un â€œcheckâ€ di 10 secondi: <strong>sto scegliendo o sto reagendo?</strong></div>
        </div>

        <div class="block">
          <h3>ğŸ” Test (breve, adesso)</h3>
          <div class="list">
            <div class="item"><span class="dot">1</span><div>Sto decidendo in <strong>fretta</strong> o con <strong>luciditÃ </strong>?</div></div>
            <div class="item"><span class="dot">2</span><div>Sto cercando <strong>approvazione</strong> o <strong>veritÃ </strong>?</div></div>
            <div class="item"><span class="dot">3</span><div>Questa scelta mi avvicina ad Allah o mi <strong>addormenta</strong>?</div></div>
          </div>
        </div>
      </div>
    </div>
  `;
}

/* =========================
   INIT
========================= */
tryRender();

/* quando si sceglie un'emozione, aggiorna il mazzo dell'Äya */
const _origMoodBtns = document.querySelectorAll("#moods .btn");
function hookAyaDeck(){
  document.querySelectorAll("#moods .btn").forEach(btn => {
    const orig = btn.onclick;
    btn.addEventListener("click", function(){
      const key = this.dataset.key;
      rebuildAyaDeck(key || null);
      updateBackContent("fc3");
      const shell = document.getElementById("fc3");
      if(shell && shell.classList.contains("flipped")) shell.classList.remove("flipped");
    });
  });
}
/* aspetta che i bottoni siano generati */
setTimeout(hookAyaDeck, 200);
</script>
</body>
</html>
